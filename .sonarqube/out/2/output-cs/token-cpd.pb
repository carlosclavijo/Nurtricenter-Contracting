“
xC:\Users\CARLOS\Desktop\Aprendizaje\CSharp\Nurtricenter-Contracting\Contracting.Infrastructure\Persistence\UnitOfWork.cs
	namespace		 	
Contracting		
 
.		 
Infrastructure		 $
.		$ %
Persistence		% 0
;		0 1
public 
class 

UnitOfWork 
( 
DomainDbContext '
	DbContext( 1
,1 2

IPublisher3 =
	Publisher> G
)G H
:I J
IUnitOfWorkK V
,V W
IOutboxDatabaseX g
<g h
DomainEventh s
>s t
{ 
private 
int	 
_contractCount 
= 
$num 
;  
public 
async 
Task 
CommitAsync 
( 
CancellationToken 0
cancellationToken1 B
=C D
defaultE L
)L M
{ 
_contractCount 
++ 
; 
var 
domainEvents 
= 
	DbContext 
. 
ChangeTracker ,
. 
Entries 
< 
Entity 
> 
( 
) 
. 
Where 	
(	 

x
 
=> 
x 
. 
Entity 
. 
DomainEvents $
.$ %
Any% (
(( )
)) *
)* +
. 
Select 

(
 
x 
=> 
{ 
var 
domainEvents 
= 
x 
. 
Entity 
. 
DomainEvents 
. 
ToImmutableArray 
( 
) 
; 
x 
. 
Entity 
. 
ClearDomainEvents 
( 
)  
;  !
return 

domainEvents 
; 
} 
) 
. 

SelectMany 
( 
domainEvents 
=> 
domainEvents +
)+ ,
. 
ToList 

(
 
) 
; 
foreach!! 	
(!!
 
var!! 
e!! 
in!! 
domainEvents!!  
)!!  !
{"" 
await## 
	Publisher##	 
.## 
Publish## 
(## 
e## 
,## 
cancellationToken## /
)##/ 0
;##0 1
}$$ 
if&& 
(&& 
_contractCount&& 
==&& 
$num&& 
)&& 
{'' 
await(( 
	DbContext((	 
.(( 
SaveChangesAsync(( #
(((# $
cancellationToken(($ 5
)((5 6
;((6 7
})) 
else** 
{++ 
_contractCount,, 
--,, 
;,, 
}-- 
}.. 
public00 
DbSet00 
<00 
OutboxMessage00 
<00 
DomainEvent00 '
>00' (
>00( )
GetOutboxMessages00* ;
(00; <
)00< =
{11 
return22 
	DbContext22	 
.22 
OutboxMessages22 !
;22! "
}33 
}44 ˘
âC:\Users\CARLOS\Desktop\Aprendizaje\CSharp\Nurtricenter-Contracting\Contracting.Infrastructure\Persistence\StoredModel\StoredDbContext.cs
	namespace 	
Contracting
 
. 
Infrastructure $
.$ %
Persistence% 0
.0 1
StoredModel1 <
;< =
public		 
class		 
StoredDbContext		 
(		 
DbContextOptions		 -
<		- .
StoredDbContext		. =
>		= >
options		? F
)		F G
:		H I
	DbContext		J S
(		S T
options		T [
)		[ \
,		\ ]
	IDatabase		^ g
{

 
public 
DbSet 
< $
AdministratorStoredModel &
>& '
Administrator( 5
{6 7
get8 ;
;; <
set= @
;@ A
}B C
public 
DbSet 
< 
PatientStoredModel  
>  !
Patient" )
{* +
get, /
;/ 0
set1 4
;4 5
}6 7
public 
DbSet 
< 
ContractStoredModel !
>! "
Contract# +
{, -
get. 1
;1 2
set3 6
;6 7
}8 9
public 
DbSet 
< "
DeliveryDayStoredModel $
>$ %
DeliveryDay& 1
{2 3
get4 7
;7 8
set9 <
;< =
}> ?
	protected 

override 
void 
OnModelCreating (
(( )
ModelBuilder) 5
modelBuilder6 B
)B C
{ 
base 
. 
OnModelCreating 
( 
modelBuilder #
)# $
;$ %
modelBuilder 
. 
AddOutboxModel 
< 
DomainEvent )
>) *
(* +
)+ ,
;, -
} 
public 
void 
Migrate 
( 
) 
{ 
Database 

.
 
Migrate 
( 
) 
; 
} 
} ì
ïC:\Users\CARLOS\Desktop\Aprendizaje\CSharp\Nurtricenter-Contracting\Contracting.Infrastructure\Persistence\StoredModel\Entities\PatientStoredModel.cs
	namespace 	
Contracting
 
. 
Infrastructure $
.$ %
Persistence% 0
.0 1
StoredModel1 <
.< =
Entities= E
;E F
[ 
Table 
( 
$str 
) 
] 
public 
class 
PatientStoredModel 
{		 
[

 
Key

 
]

 
[ 
Column 
( 	
$str	 
) 
] 
public 
Guid 
Id 
{ 
get 
; 
set 
; 
} 
[ 
Column 
( 	
$str	 
) 
] 
[ 
StringLength 
( 
$num 
) 
] 
[ 
Required 

]
 
public 
string 
PatientName 
{ 
get  
;  !
set" %
;% &
}' (
[ 
Column 
( 	
$str	 
) 
] 
[ 
StringLength 
( 
$num 
) 
] 
[ 
Required 

]
 
public 
string 
PatientPhone 
{ 
get !
;! "
set# &
;& '
}( )
} ∞
ôC:\Users\CARLOS\Desktop\Aprendizaje\CSharp\Nurtricenter-Contracting\Contracting.Infrastructure\Persistence\StoredModel\Entities\DeliveryDayStoredModel.cs
	namespace 	
Contracting
 
. 
Infrastructure $
.$ %
Persistence% 0
.0 1
StoredModel1 <
.< =
Entities= E
;E F
[ 
Table 
( 
$str 
) 
] 
public 
class "
DeliveryDayStoredModel #
{ 
[		 
Key		 
]		 
[

 
Column

 
(

 	
$str

	 
)

 
]

 
public 
Guid 
Id 
{ 
get 
; 
set 
; 
} 
[ 
Required 

]
 
[ 
Column 
( 	
$str	 
) 
] 
public 
Guid 

ContractId 
{ 
get 
; 
set "
;" #
}$ %
public 
ContractStoredModel 
Contract $
{% &
get' *
;* +
set, /
;/ 0
}1 2
[ 
Required 

]
 
[ 
Column 
( 	
$str	 
) 
] 
public 
DateTime 
Date 
{ 
get 
; 
set  
;  !
}" #
[ 
Required 

]
 
[ 
Column 
( 	
$str	 
) 
] 
[ 
StringLength 
( 
$num 
) 
] 
public 
string 
Street 
{ 
get 
; 
set  
;  !
}" #
[ 
Required 

]
 
[ 
Column 
( 	
$str	 
) 
] 
public 
int 
Number 
{ 
get 
; 
set 
; 
}  
} ”!
ñC:\Users\CARLOS\Desktop\Aprendizaje\CSharp\Nurtricenter-Contracting\Contracting.Infrastructure\Persistence\StoredModel\Entities\ContractStoredModel.cs
	namespace 	
Contracting
 
. 
Infrastructure $
.$ %
Persistence% 0
.0 1
StoredModel1 <
.< =
Entities= E
;E F
[ 
Table 
( 
$str 
) 
] 
public 
class 
ContractStoredModel  
{ 
[		 
Key		 
]		 
[

 
Column

 
(

 	
$str

	 
)

 
]

 
public 
Guid 
Id 
{ 
get 
; 
set 
; 
} 
[ 
Required 

]
 
[ 
Column 
( 	
$str	 
) 
] 
public 
Guid 
AdministratorId 
{ 
get "
;" #
set$ '
;' (
}) *
public $
AdministratorStoredModel  
Administrator! .
{/ 0
get1 4
;4 5
set6 9
;9 :
}; <
[ 
Required 

]
 
[ 
Column 
( 	
$str	 
) 
] 
public 
Guid 
	PatientId 
{ 
get 
; 
set !
;! "
}# $
public 
PatientStoredModel 
Patient "
{# $
get% (
;( )
set* -
;- .
}/ 0
[ 
Required 

]
 
[ 
Column 
( 	
$str	 
) 
] 
[ 
	MaxLength 
( 
$num 
) 
] 
public 
string 
TransactionType 
{  
get! $
;$ %
set& )
;) *
}+ ,
[ 
Required 

]
 
[ 
Column 
( 	
$str	 
) 
] 
[ 
	MaxLength 
( 
$num 
) 
] 
public 
string 
TransactionStatus  
{! "
get# &
;& '
set( +
;+ ,
}- .
[!! 
Required!! 

]!!
 
["" 
Column"" 
("" 	
$str""	 
,"" 
TypeName"" !
=""" #
$str""$ /
)""/ 0
]""0 1
public## 
DateTime## 
CreationDate## 
{## 
get##  #
;### $
set##% (
;##( )
}##* +
[%% 
Required%% 

]%%
 
[&& 
Column&& 
(&& 	
$str&&	 
,&& 
TypeName&& 
=&&  
$str&&! ,
)&&, -
]&&- .
public'' 
DateTime'' 
	StartDate'' 
{'' 
get''  
;''  !
set''" %
;''% &
}''' (
[)) 
Column)) 
()) 	
$str))	 
,)) 
TypeName)) "
=))# $
$str))% 0
)))0 1
]))1 2
public** 
DateTime** 
?** 
CompletedDate** 
{**  !
get**" %
;**% &
set**' *
;*** +
}**, -
[,, 
Column,, 
(,, 	
$str,,	 
,,, 
TypeName,, 
=,,  
$str,,! 0
),,0 1
],,1 2
public-- 
decimal-- 
	TotalCost-- 
{-- 
get-- 
;--  
set--! $
;--$ %
}--& '
public// 
List// 
<// "
DeliveryDayStoredModel// #
>//# $
DeliveryDays//% 1
{//2 3
get//4 7
;//7 8
set//9 <
;//< =
}//> ?
}00 ´
õC:\Users\CARLOS\Desktop\Aprendizaje\CSharp\Nurtricenter-Contracting\Contracting.Infrastructure\Persistence\StoredModel\Entities\AdministratorStoredModel.cs
	namespace 	
Contracting
 
. 
Infrastructure $
.$ %
Persistence% 0
.0 1
StoredModel1 <
.< =
Entities= E
;E F
[ 
Table 
( 
$str 
) 
] 
public 
class $
AdministratorStoredModel %
{		 
[

 
Key

 
]

 
[ 
Column 
( 	
$str	 
) 
] 
public 
Guid 
Id 
{ 
get 
; 
set 
; 
} 
[ 
Column 
( 	
$str	 
) 
] 
[ 
StringLength 
( 
$num 
) 
] 
[ 
Required 

]
 
public 
string 
AdministratorName  
{! "
get# &
;& '
set( +
;+ ,
}- .
[ 
Column 
( 	
$str	 
) 
] 
[ 
StringLength 
( 
$num 
) 
] 
[ 
Required 

]
 
public 
string 
AdministratorPhone !
{" #
get$ '
;' (
set) ,
;, -
}. /
} µ
çC:\Users\CARLOS\Desktop\Aprendizaje\CSharp\Nurtricenter-Contracting\Contracting.Infrastructure\Persistence\Repositories\ContractRepository.cs
	namespace 	
Contracting
 
. 
Infrastructure $
.$ %
Persistence% 0
.0 1
Repositories1 =
;= >
public 
class 
ContractRepository 
(  
DomainDbContext  /
	DbContext0 9
)9 :
:; <
IContractRepository= P
{ 
public		 
async		 
Task		 
AddSync		 
(		 
Contract		 #
entity		$ *
)		* +
{

 
await 
	DbContext 
. 
Contract 
. 
AddAsync #
(# $
entity$ *
)* +
;+ ,
} 
public 
async 
Task 
DeleteAsync 
( 
Guid #
id$ &
)& '
{ 
var 
obj 	
=
 
await 
GetByIdAsync 
( 
id !
)! "
;" #
if 
( 
obj 	
!=
 
null 
) 
{ 
	DbContext 
. 
Contract 
. 
Remove 
( 
obj  
)  !
;! "
} 
} 
public 
async 
Task 
< 
Contract 
? 
> 
GetByIdAsync *
(* +
Guid+ /
id0 2
,2 3
bool4 8
readOnly9 A
=B C
falseD I
)I J
{ 
return 
await	 
	DbContext 
. 
Contract !
.! "
Include" )
() *
c* +
=>, .
c/ 0
.0 1
DeliveryDays1 =
)= >
.> ?
FirstOrDefaultAsync? R
(R S
iS T
=>U W
iX Y
.Y Z
IdZ \
==] _
id` b
)b c
;c d
} 
public 
Task 
UpdateAsync 
( 
Contract !
contract" *
)* +
{ 
	DbContext 
. 
Contract 
. 
Update 
( 
contract $
)$ %
;% &
return 
Task	 
. 
CompletedTask 
; 
}   
}!! Ø
åC:\Users\CARLOS\Desktop\Aprendizaje\CSharp\Nurtricenter-Contracting\Contracting.Infrastructure\Persistence\Repositories\PatientRepository.cs
	namespace 	
Contracting
 
. 
Infrastructure $
.$ %
Persistence% 0
.0 1
Repositories1 =
;= >
public 
class 
PatientRepository 
( 
DomainDbContext .
	DbContext/ 8
)8 9
:: ;
IPatientRepository< N
{ 
public		 
async		 
Task		 
AddSync		 
(		 
Patient		 "
entity		# )
)		) *
{

 
await 
	DbContext 
. 
Patient 
. 
AddAsync "
(" #
entity# )
)) *
;* +
} 
public 
async 
Task 
DeleteAsync 
( 
Guid #
id$ &
)& '
{ 
var 
obj 	
=
 
await 
GetByIdAsync 
( 
id !
)! "
;" #
	DbContext 
. 
Patient 
. 
Remove 
( 
obj 
) 
;  
} 
public 
async 
Task 
< 
Patient 
? 
> 
GetByIdAsync )
() *
Guid* .
id/ 1
,1 2
bool3 7
readOnly8 @
=A B
falseC H
)H I
{ 
if 
( 
readOnly 
) 
{ 
return 	
await
 
	DbContext 
. 
Patient !
.! "
AsNoTracking" .
(. /
)/ 0
.0 1
FirstOrDefaultAsync1 D
(D E
iE F
=>G I
iJ K
.K L
IdL N
==O Q
idR T
)T U
;U V
} 
else 
{ 
return 	
await
 
	DbContext 
. 
Patient !
.! "
	FindAsync" +
(+ ,
id, .
). /
;/ 0
} 
} 
public   
Task   
UpdateAsync   
(   
Patient    
patient  ! (
)  ( )
{!! 
	DbContext"" 
."" 
Patient"" 
."" 
Update"" 
("" 
patient"" "
)""" #
;""# $
return## 
Task##	 
.## 
CompletedTask## 
;## 
}$$ 
}%% √
èC:\Users\CARLOS\Desktop\Aprendizaje\CSharp\Nurtricenter-Contracting\Contracting.Infrastructure\Persistence\Repositories\OutboxTracingService.cs
	namespace 	
Contracting
 
. 
Infrastructure $
.$ %
Persistence% 0
.0 1
Repositories1 =
;= >
public 
class  
OutboxTracingService !
<! "
T" #
># $
($ %
IOutboxService% 3
<3 4
T4 5
>5 6
BaseOutService7 E
,E F
ITracingProviderG W
TracingProviderX g
)g h
:i j
IOutboxServicek y
<y z
Tz {
>{ |
{ 
public		 
async		 
Task		 
AddAsync		 
(		 
OutboxMessage		 )
<		) *
T		* +
>		+ ,
message		- 4
)		4 5
{

 
OutboxMessage 
< 
T 
> 
outboxMessage  
=! "
new# &
(& '
message' .
.. /
Content/ 6
,6 7
TracingProvider 
. 
GetCorrelationId #
(# $
)$ %
,% &
TracingProvider 
. 

GetTraceId 
( 
) 
,  
TracingProvider 
. 
	GetSpanId 
( 
) 
) 
;  
await 
BaseOutService 
. 
AddAsync 
(  
outboxMessage  -
)- .
;. /
} 
} ˝
íC:\Users\CARLOS\Desktop\Aprendizaje\CSharp\Nurtricenter-Contracting\Contracting.Infrastructure\Persistence\Repositories\AdministratorRepository.cs
	namespace 	
Contracting
 
. 
Infrastructure $
.$ %
Persistence% 0
.0 1
Repositories1 =
;= >
public 
class #
AdministratorRepository $
($ %
DomainDbContext% 4
	DbContext5 >
)> ?
:@ A$
IAdministratorRepositoryB Z
{ 
public		 
async		 
Task		 
AddSync		 
(		 
Administrator		 (
entity		) /
)		/ 0
{

 
await 
	DbContext 
. 
Administrator 
.  
AddAsync  (
(( )
entity) /
)/ 0
;0 1
} 
public 
async 
Task 
DeleteAsync 
( 
Guid #
id$ &
)& '
{ 
var 
obj 	
=
 
await 
GetByIdAsync 
( 
id !
)! "
;" #
	DbContext 
. 
Administrator 
. 
Remove  
(  !
obj! $
)$ %
;% &
} 
public 
async 
Task 
< 
Administrator  
?  !
>! "
GetByIdAsync# /
(/ 0
Guid0 4
id5 7
,7 8
bool9 =
readOnly> F
=G H
falseI N
)N O
{ 
if 
( 
readOnly 
) 
{ 
return 	
await
 
	DbContext 
. 
Administrator '
.' (
AsNoTracking( 4
(4 5
)5 6
.6 7
FirstOrDefaultAsync7 J
(J K
iK L
=>M O
iP Q
.Q R
IdR T
==U W
idX Z
)Z [
;[ \
} 
else 
{ 
return 	
await
 
	DbContext 
. 
Administrator '
.' (
	FindAsync( 1
(1 2
id2 4
)4 5
;5 6
} 
} 
public   
Task   
UpdateAsync   
(   
Administrator   &
administrador  ' 4
)  4 5
{!! 
	DbContext"" 
."" 
Administrator"" 
."" 
Update""  
(""  !
administrador""! .
)"". /
;""/ 0
return## 
Task##	 
.## 
CompletedTask## 
;## 
}$$ 
}%% ﬂ
wC:\Users\CARLOS\Desktop\Aprendizaje\CSharp\Nurtricenter-Contracting\Contracting.Infrastructure\Persistence\IDatabase.cs
	namespace 	
Contracting
 
. 
Infrastructure $
.$ %
Persistence% 0
;0 1
public 
	interface 
	IDatabase 
: 
IDisposable (
{ 
void 
Migrate 
( 
) 
; 
} ù
âC:\Users\CARLOS\Desktop\Aprendizaje\CSharp\Nurtricenter-Contracting\Contracting.Infrastructure\Persistence\DomainModel\DomainDbContext.cs
	namespace		 	
Contracting		
 
.		 
Infrastructure		 $
.		$ %
Persistence		% 0
.		0 1
DomainModel		1 <
;		< =
public 
class 
DomainDbContext 
( 
DbContextOptions -
<- .
DomainDbContext. =
>= >
options? F
)F G
:H I
	DbContextJ S
(S T
optionsT [
)[ \
{ 
public 
DbSet 
< 
Administrator 
> 
Administrator *
{+ ,
get- 0
;0 1
set2 5
;5 6
}7 8
public 
DbSet 
< 
Patient 
> 
Patient 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
DbSet 
< 
Contract 
> 
Contract  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 
DbSet 
< 
OutboxMessage 
< 
DomainEvent '
>' (
>( )
OutboxMessages* 8
{9 :
get; >
;> ?
set@ C
;C D
}E F
	protected 

override 
void 
OnModelCreating (
(( )
ModelBuilder) 5
modelBuilder6 B
)B C
{ 
modelBuilder 
. +
ApplyConfigurationsFromAssembly .
(. /
typeof/ 5
(5 6
DomainDbContext6 E
)E F
.F G
AssemblyG O
)O P
;P Q
modelBuilder 
. 
AddOutboxModel 
< 
DomainEvent )
>) *
(* +
)+ ,
;, -
base 
. 
OnModelCreating 
( 
modelBuilder #
)# $
;$ %
modelBuilder 
. 
Ignore 
< 
DomainEvent !
>! "
(" #
)# $
;$ %
} 
} ª
éC:\Users\CARLOS\Desktop\Aprendizaje\CSharp\Nurtricenter-Contracting\Contracting.Infrastructure\Persistence\DomainModel\Config\PatientConfig.cs
	namespace 	
Contracting
 
. 
Infrastructure $
.$ %
Persistence% 0
.0 1
DomainModel1 <
.< =
Config= C
;C D
public		 
class		 
PatientConfig		 
:		 $
IEntityTypeConfiguration		 5
<		5 6
Patient		6 =
>		= >
{

 
public 
void 
	Configure 
( 
EntityTypeBuilder (
<( )
Patient) 0
>0 1
builder2 9
)9 :
{ 
builder 	
.	 

ToTable
 
( 
$str 
) 
; 
builder 	
.	 

HasKey
 
( 
x 
=> 
x 
. 
Id 
) 
; 
builder 	
.	 

Property
 
( 
x 
=> 
x 
. 
Id 
) 
. 
HasColumnName +
(+ ,
$str, 7
)7 8
;8 9
var 
nameConverter 
= 
new 
ValueConverter (
<( )
FullNameValue) 6
,6 7
string8 >
>> ?
(? @
FullNameValue 
=> 
FullNameValue !
.! "
Name" &
,& '
name 
=> 

new 
FullNameValue 
( 
name !
)! "
) 
; 
builder 	
.	 

Property
 
( 
x 
=> 
x 
. 
Name 
) 
.  
HasColumnName  -
(- .
$str. 4
)4 5
.5 6
HasConversion6 C
(C D
nameConverterD Q
)Q R
;R S
var 
phoneConverter 
= 
new 
ValueConverter )
<) *
PhoneNumberValue* :
,: ;
string< B
>B C
(C D
PhoneNumberValue 
=> 
PhoneNumberValue '
.' (
Phone( -
,- .
phone 
=>	 
new 
PhoneNumberValue  
(  !
phone! &
)& '
) 
; 
builder 	
.	 

Property
 
( 
x 
=> 
x 
. 
Phone 
)  
.  !
HasColumnName! .
(. /
$str/ 6
)6 7
.7 8
HasConversion8 E
(E F
phoneConverterF T
)T U
;U V
builder!! 	
.!!	 

Ignore!!
 
(!! 
$str!!  
)!!  !
;!!! "
builder"" 	
.""	 

Ignore""
 
("" 
x"" 
=>"" 
x"" 
."" 
DomainEvents"" $
)""$ %
;""% &
}## 
}$$ ∑K
èC:\Users\CARLOS\Desktop\Aprendizaje\CSharp\Nurtricenter-Contracting\Contracting.Infrastructure\Persistence\DomainModel\Config\ContractConfig.cs
	namespace 	
Contracting
 
. 
Infrastructure $
.$ %
Persistence% 0
.0 1
DomainModel1 <
.< =
Config= C
;C D
public

 
class

 
ContractConfig

 
:

 $
IEntityTypeConfiguration

 6
<

6 7
Contract

7 ?
>

? @
,

@ A$
IEntityTypeConfiguration

B Z
<

Z [
DeliveryDay

[ f
>

f g
{ 
public 
void 
	Configure 
( 
EntityTypeBuilder (
<( )
Contract) 1
>1 2
builder3 :
): ;
{ 
builder 	
.	 

ToTable
 
( 
$str 
) 
; 
builder 	
.	 

HasKey
 
( 
x 
=> 
x 
. 
Id 
) 
; 
builder 	
.	 

Property
 
( 
x 
=> 
x 
. 
Id 
) 
. 
HasColumnName +
(+ ,
$str, 8
)8 9
;9 :
builder 	
.	 

Property
 
( 
x 
=> 
x 
. 
AdministratorId )
)) *
.* +
HasColumnName+ 8
(8 9
$str9 J
)J K
;K L
builder 	
.	 

Property
 
( 
x 
=> 
x 
. 
	PatientId #
)# $
.$ %
HasColumnName% 2
(2 3
$str3 >
)> ?
;? @
var 
typeConverter 
= 
new 
ValueConverter (
<( )
ContractType) 5
,5 6
string7 =
>= >
(> ?
typeEnumValue 
=> 
typeEnumValue !
.! "
ToString" *
(* +
)+ ,
,, -
type 
=> 

( 
ContractType 
) 
Enum 
. 
Parse #
(# $
typeof$ *
(* +
ContractType+ 7
)7 8
,8 9
type: >
)> ?
) 
; 
builder 	
.	 

Property
 
( 
x 
=> 
x 
. 
Type 
) 
.  
HasConversion  -
(- .
typeConverter. ;
); <
.< =
HasColumnName= J
(J K
$strK \
)\ ]
;] ^
var 
statusConverter 
= 
new 
ValueConverter *
<* +
ContractStatus+ 9
,9 :
string; A
>A B
(B C
statusEnumValue   
=>   
statusEnumValue   %
.  % &
ToString  & .
(  . /
)  / 0
,  0 1
status!! 	
=>!!
 
(!! 
ContractStatus!! 
)!! 
Enum!! !
.!!! "
Parse!!" '
(!!' (
typeof!!( .
(!!. /
ContractStatus!!/ =
)!!= >
,!!> ?
status!!@ F
)!!F G
)"" 
;"" 
builder$$ 	
.$$	 

Property$$
 
($$ 
x$$ 
=>$$ 
x$$ 
.$$ 
Status$$  
)$$  !
.$$! "
HasConversion$$" /
($$/ 0
statusConverter$$0 ?
)$$? @
.$$@ A
HasColumnName$$A N
($$N O
$str$$O b
)$$b c
;$$c d
builder&& 	
.&&	 

Property&&
 
(&& 
x&& 
=>&& 
x&& 
.&& 
CreationDate&& &
)&&& '
.&&' (
HasColumnName&&( 5
(&&5 6
$str&&6 D
)&&D E
;&&E F
builder(( 	
.((	 

Property((
 
((( 
x(( 
=>(( 
x(( 
.(( 
	StartDate(( #
)((# $
.(($ %
HasColumnName((% 2
(((2 3
$str((3 >
)((> ?
;((? @
builder** 	
.**	 

Property**
 
(** 
x** 
=>** 
x** 
.** 
CompletedDate** '
)**' (
.**( )
HasColumnName**) 6
(**6 7
$str**7 F
)**F G
.**G H

IsRequired**H R
(**R S
false**S X
)**X Y
;**Y Z
var,, 
costConverter,, 
=,, 
new,, 
ValueConverter,, (
<,,( )
	CostValue,,) 2
,,,2 3
decimal,,4 ;
>,,; <
(,,< =
	costValue-- 
=>-- 
	costValue-- 
.-- 
Value-- 
,--  
cost.. 
=>.. 

new.. 
	CostValue.. 
(.. 
cost.. 
).. 
)// 
;// 
builder11 	
.11	 

Property11
 
(11 
x11 
=>11 
x11 
.11 
Cost11 
)11 
.11  
HasColumnName11  -
(11- .
$str11. 9
)119 :
.11: ;
HasConversion11; H
(11H I
costConverter11I V
)11V W
;11W X
builder33 	
.33	 

HasMany33
 
(33 
c33 
=>33 
c33 
.33 
DeliveryDays33 %
)33% &
.44 
WithOne44 
(44 
)44 
.55 
HasForeignKey55 
(55 
c55 
=>55 
c55 
.55 

ContractId55 &
)55& '
.66 
OnDelete66 
(66 
DeleteBehavior66 
.66 
Cascade66 &
)66& '
;66' (
builder88 	
.88	 

Ignore88
 
(88 
$str88  
)88  !
;88! "
builder99 	
.99	 

Ignore99
 
(99 
x99 
=>99 
x99 
.99 
DomainEvents99 $
)99$ %
;99% &
}:: 
public<< 
void<< 
	Configure<< 
(<< 
EntityTypeBuilder<< (
<<<( )
DeliveryDay<<) 4
><<4 5
builder<<6 =
)<<= >
{== 
builder>> 	
.>>	 

ToTable>>
 
(>> 
$str>>  
)>>  !
;>>! "
builder@@ 	
.@@	 

HasKey@@
 
(@@ 
x@@ 
=>@@ 
x@@ 
.@@ 
Id@@ 
)@@ 
;@@ 
builderBB 	
.BB	 

PropertyBB
 
(BB 
xBB 
=>BB 
xBB 
.BB 
IdBB 
)BB 
.BB 
HasColumnNameBB +
(BB+ ,
$strBB, ;
)BB; <
;BB< =
builderCC 	
.CC	 

PropertyCC
 
(CC 
xCC 
=>CC 
xCC 
.CC 

ContractIdCC $
)CC$ %
.CC% &
HasColumnNameCC& 3
(CC3 4
$strCC4 @
)CC@ A
;CCA B
builderEE 	
.EE	 

PropertyEE
 
(EE 
xEE 
=>EE 
xEE 
.EE 
DateEE 
)EE 
.EE  
HasColumnNameEE  -
(EE- .
$strEE. 4
)EE4 5
.EE5 6
HasConversionEE6 C
(EEC D
vFF 
=>FF 	
vFF
 
.FF 
ToUniversalTimeFF 
(FF 
)FF 
,FF 
vGG 
=>GG 	
DateTimeGG
 
.GG 
SpecifyKindGG 
(GG 
vGG  
,GG  !
DateTimeKindGG" .
.GG. /
UtcGG/ 2
)GG2 3
)HH 
;HH 
builderJJ 	
.JJ	 

PropertyJJ
 
(JJ 
xJJ 
=>JJ 
xJJ 
.JJ 
StreetJJ  
)JJ  !
.JJ! "
HasColumnNameJJ" /
(JJ/ 0
$strJJ0 8
)JJ8 9
;JJ9 :
builderKK 	
.KK	 

PropertyKK
 
(KK 
xKK 
=>KK 
xKK 
.KK 
NumberKK  
)KK  !
.KK! "
HasColumnNameKK" /
(KK/ 0
$strKK0 8
)KK8 9
;KK9 :
builderMM 	
.MM	 

HasOneMM
 
<MM 
ContractMM 
>MM 
(MM 
)MM 
.NN 
WithManyNN 
(NN 
cNN 
=>NN 
cNN 
.NN 
DeliveryDaysNN #
)NN# $
.OO 
HasForeignKeyOO 
(OO 
dOO 
=>OO 
dOO 
.OO 

ContractIdOO &
)OO& '
.PP 
OnDeletePP 
(PP 
DeleteBehaviorPP 
.PP 
CascadePP &
)PP& '
;PP' (
}QQ 
}RR ”
îC:\Users\CARLOS\Desktop\Aprendizaje\CSharp\Nurtricenter-Contracting\Contracting.Infrastructure\Persistence\DomainModel\Config\AdministratorConfig.cs
	namespace 	
Contracting
 
. 
Infrastructure $
.$ %
Persistence% 0
.0 1
DomainModel1 <
.< =
Config= C
;C D
public		 
class		 
AdministratorConfig		  
:		! "$
IEntityTypeConfiguration		# ;
<		; <
Administrator		< I
>		I J
{

 
public 
void 
	Configure 
( 
EntityTypeBuilder (
<( )
Administrator) 6
>6 7
builder8 ?
)? @
{ 
builder 	
.	 

ToTable
 
( 
$str "
)" #
;# $
builder 	
.	 

HasKey
 
( 
x 
=> 
x 
. 
Id 
) 
; 
builder 	
.	 

Property
 
( 
x 
=> 
x 
. 
Id 
) 
. 
HasColumnName +
(+ ,
$str, =
)= >
;> ?
var 
nameConverter 
= 
new 
ValueConverter (
<( )
FullNameValue) 6
,6 7
string8 >
>> ?
(? @
FullNameValue 
=> 
FullNameValue !
.! "
Name" &
,& '
name 
=> 

new 
FullNameValue 
( 
name !
)! "
) 
; 
builder 	
.	 

Property
 
( 
x 
=> 
x 
. 
Name 
) 
.  
HasColumnName  -
(- .
$str. 4
)4 5
.5 6
HasConversion6 C
(C D
nameConverterD Q
)Q R
;R S
var 
phoneConverter 
= 
new 
ValueConverter )
<) *
PhoneNumberValue* :
,: ;
string< B
>B C
(C D
PhoneNumberValue 
=> 
PhoneNumberValue '
.' (
Phone( -
,- .
phone 
=>	 
new 
PhoneNumberValue  
(  !
phone! &
)& '
) 
; 
builder 	
.	 

Property
 
( 
x 
=> 
x 
. 
Phone 
)  
.  !
HasColumnName! .
(. /
$str/ 6
)6 7
.7 8
HasConversion8 E
(E F
phoneConverterF T
)T U
;U V
builder!! 	
.!!	 

Ignore!!
 
(!! 
$str!!  
)!!  !
;!!! "
builder"" 	
.""	 

Ignore""
 
("" 
x"" 
=>"" 
x"" 
."" 
DomainEvents"" $
)""$ %
;""% &
}## 
}$$ Â
~C:\Users\CARLOS\Desktop\Aprendizaje\CSharp\Nurtricenter-Contracting\Contracting.Infrastructure\Persistence\DatabaseSettings.cs
	namespace 	
Contracting
 
. 
Infrastructure $
.$ %
Persistence% 0
;0 1
public 
class 
DatabaseSettings 
{ 
public 
string 
ConnectionString 
{  !
get" %
;% &
set' *
;* +
}, -
=. /
string0 6
.6 7
Empty7 <
;< =
} µ
ÜC:\Users\CARLOS\Desktop\Aprendizaje\CSharp\Nurtricenter-Contracting\Contracting.Infrastructure\Handlers\Patients\GetPatientsHandler.cs
	namespace 	
Contracting
 
. 
Infrastructure $
.$ %
Handlers% -
.- .
Patients. 6
;6 7
public 
class 
GetPatientsHandler 
(  
StoredDbContext  /
	DbContext0 9
)9 :
:; <
IRequestHandler= L
<L M
GetPatientsQueryM ]
,] ^
IEnumerable_ j
<j k

PatientDtok u
>u v
>v w
{		 
public

 
async

 
Task

 
<

 
IEnumerable

 
<

 

PatientDto

 )
>

) *
>

* +
Handle

, 2
(

2 3
GetPatientsQuery

3 C
request

D K
,

K L
CancellationToken

M ^
cancellationToken

_ p
)

p q
{ 
return 
await 
	DbContext 
. 
Patient &
.& '
AsNoTracking' 3
(3 4
)4 5
. 
Select 
( 
i 
=> 
new 

PatientDto (
(( )
)) *
{ 
Id 
= 
i 
. 
Id 
, 
PatientName 
= 
i 
.  
PatientName  +
,+ ,
PatientPhone 
= 
i  
.  !
PatientPhone! -
} 
) 
. 
ToListAsync 
( 
cancellationToken *
)* +
;+ ,
} 
} 
âC:\Users\CARLOS\Desktop\Aprendizaje\CSharp\Nurtricenter-Contracting\Contracting.Infrastructure\Handlers\Patients\GetPatientByIdHandler.cs
	namespace 	
Contracting
 
. 
Infrastructure $
.$ %
Handlers% -
.- .
Patients. 6
;6 7
public

 
class

 !
GetPatientByIdHandler

 "
(

" #
StoredDbContext

# 2
	DbContext

3 <
)

< =
:

> ?
IRequestHandler

@ O
<

O P
GetPatientByIdQuery

P c
,

c d
Result

e k
<

k l

PatientDto

l v
>

v w
>

w x
{ 
public 
async 
Task 
< 
Result 
< 

PatientDto $
>$ %
>% &
Handle' -
(- .
GetPatientByIdQuery. A
requestB I
,I J
CancellationTokenK \
cancellationToken] n
)n o
{ 
var 
patient 
= 
await 
	DbContext %
.% &
Patient& -
.- .
AsNoTracking. :
(: ;
); <
. 
Where 
( 
p 
=> 
p 
. 
Id 
==  
request! (
.( )
	PatientId) 2
)2 3
. 
Select 
( 
p 
=> 
new 

PatientDto '
(' (
)( )
{ 
Id 
= 
p 
. 
Id 
, 
PatientName 
= 
p 
.  
PatientName  +
,+ ,
PatientPhone 
= 
p  
.  !
PatientPhone! -
} 
) 
. 
FirstOrDefaultAsync  
(  !
cancellationToken! 2
)2 3
;3 4
return 
patient 
; 
} 
} ¬
äC:\Users\CARLOS\Desktop\Aprendizaje\CSharp\Nurtricenter-Contracting\Contracting.Infrastructure\Handlers\Contracts\GetDeliveryDayHandler.cs
	namespace 	
Contracting
 
. 
Infrastructure $
.$ %
Handlers% -
.- .
	Contracts. 7
;7 8
public

 
class

 !
GetDeliveryDayHandler

 "
(

" #
StoredDbContext

# 2
	DbContext

3 <
)

< =
:

> ?
IRequestHandler

@ O
<

O P
GetDeliveryDayQuery

P c
,

c d
Result

e k
<

k l
DeliveryDayDto

l z
>

z {
>

{ |
{ 
public 
async 
Task 
< 
Result 
< 
DeliveryDayDto (
>( )
>) *
Handle+ 1
(1 2
GetDeliveryDayQuery2 E
requestF M
,M N
CancellationTokenO `
cancellationTokena r
)r s
{ 
var 
delivery 
= 
await 
	DbContext  
.  !
DeliveryDay! ,
., -
AsNoTracking- 9
(9 :
): ;
. 
Where 
( 
d 
=> 
d 
. 
Id 
== 
request !
.! "
DeliveryDayId" /
)/ 0
. 
Select 
( 
c 
=> 
new 
DeliveryDayDto %
(% &
)& '
{ 
Id 	
=
 
c 
. 
Id 
, 

ContractId 
= 
c 
. 

ContractId  
,  !
DateTime 
= 
c 
. 
Date 
, 
Street 
= 
c 
. 
Street 
, 
Number 
= 
c 
. 
Number 
} 
) 
. 
FirstOrDefaultAsync 
( 
cancellationToken ,
), -
;- .
return 
delivery	 
; 
} 
} ‘
àC:\Users\CARLOS\Desktop\Aprendizaje\CSharp\Nurtricenter-Contracting\Contracting.Infrastructure\Handlers\Contracts\GetContractsHandler.cs
	namespace 	
Contracting
 
. 
Infrastructure $
.$ %
Handlers% -
.- .
	Contracts. 7
;7 8
public		 
class		 
GetContractsHandler		  
(		  !
StoredDbContext		! 0
	DbContext		1 :
)		: ;
:		< =
IRequestHandler		> M
<		M N
GetContractsQuery		N _
,		_ `
IEnumerable		a l
<		l m
ContractDto		m x
>		x y
>		y z
{

 
public 
async 
Task 
< 
IEnumerable 
< 
ContractDto *
>* +
>+ ,
Handle- 3
(3 4
GetContractsQuery4 E
requestF M
,M N
CancellationTokenO `
cancellationTokena r
)r s
{ 
return 
await 
	DbContext 
. 
Contract '
.' (
AsNoTracking( 4
(4 5
)5 6
. 
Select 
( 
c 
=> 
new 
ContractDto (
(( )
)) *
{ 
Id 
= 
c 
. 
Id 
, 
AdministratorId 
=  !
c" #
.# $
AdministratorId$ 3
,3 4
	PatientId 
= 
c 
. 
	PatientId '
,' (
Type 
= 
c 
. 
TransactionType (
,( )
Status 
= 
c 
. 
TransactionStatus ,
,, -
CreationDate 
= 
c  
.  !
CreationDate! -
,- .
	StartDate 
= 
c 
. 
	StartDate '
,' (
CompleteDate 
= 
c  
.  !
CompletedDate! .
??/ 1
default2 9
,9 :
	CostValue 
= 
c 
. 
	TotalCost '
,' (
DeliveryDays 
= 
c  
.  !
DeliveryDays! -
.- .
Select. 4
(4 5
d5 6
=>7 9
new: =
DeliveryDayDto> L
(L M
)M N
{ 
Id 
= 
d 
. 
Id 
, 

ContractId 
=  
d! "
." #

ContractId# -
,- .
DateTime 
= 
d  
.  !
Date! %
,% &
Street 
= 
d 
. 
Street %
,% &
Number 
= 
d 
. 
Number %
}   
)   
.   
ToList   
(   
)   
}!! 
)!! 
."" 
ToListAsync"" 
("" 
cancellationToken"" *
)""* +
;""+ ,
}## 
}$$ í
ãC:\Users\CARLOS\Desktop\Aprendizaje\CSharp\Nurtricenter-Contracting\Contracting.Infrastructure\Handlers\Contracts\GetContractByIdHandler.cs
	namespace 	
Contracting
 
. 
Infrastructure $
.$ %
Handlers% -
.- .
	Contracts. 7
;7 8
public

 
class

 "
GetContractByIdHandler

 #
(

# $
StoredDbContext

$ 3
	DbContext

4 =
)

= >
:

? @
IRequestHandler

A P
<

P Q 
GetContractByIdQuery

Q e
,

e f
Result

g m
<

m n
ContractDto

n y
>

y z
>

z {
{ 
public 
async 
Task 
< 
Result 
< 
ContractDto %
>% &
>& '
Handle( .
(. / 
GetContractByIdQuery/ C
requestD K
,K L
CancellationTokenM ^
cancellationToken_ p
)p q
{ 
var 
contract 
= 
await 
	DbContext &
.& '
Contract' /
./ 0
AsNoTracking0 <
(< =
)= >
. 
Where 
( 
c 
=> 
c 
. 
Id 
==  "
request# *
.* +

ContractId+ 5
)5 6
. 
Select 
( 
c 
=> 
new 
ContractDto  +
(+ ,
), -
{ 
Id 
= 
c 
. 
Id 
, 
AdministratorId "
=# $
c% &
.& '
AdministratorId' 6
,6 7
	PatientId 
= 
c  
.  !
	PatientId! *
,* +
Type 
= 
c 
. 
TransactionType +
,+ ,
Status 
= 
c 
. 
TransactionStatus /
,/ 0
CreationDate 
=  !
c" #
.# $
CreationDate$ 0
,0 1
	StartDate 
= 
c  
.  !
	StartDate! *
,* +
CompleteDate 
=  !
c" #
.# $
CompletedDate$ 1
??2 4
default5 <
,< =
	CostValue 
= 
c  
.  !
	TotalCost! *
,* +
DeliveryDays 
=  !
c" #
.# $
DeliveryDays$ 0
.0 1
Select1 7
(7 8
d8 9
=>: <
new= @
DeliveryDayDtoA O
(O P
)P Q
{ 
Id 
= 
d 
. 
Id  
,  !

ContractId !
=" #
d$ %
.% &

ContractId& 0
,0 1
DateTime 
=  !
d" #
.# $
Date$ (
,( )
Street   
=   
d    !
.  ! "
Street  " (
,  ( )
Number!! 
=!! 
d!!  !
.!!! "
Number!!" (
}"" 
)"" 
."" 
ToList"" 
("" 
)"" 
}## 
)## 
.$$ 
FirstOrDefaultAsync$$ #
($$# $
cancellationToken$$$ 5
)$$5 6
;$$6 7
return%% 
contract%% 
;%% 
}&& 
}'' è
íC:\Users\CARLOS\Desktop\Aprendizaje\CSharp\Nurtricenter-Contracting\Contracting.Infrastructure\Handlers\Administrators\GetAdministratorsHandler.cs
	namespace 	
Contracting
 
. 
Infrastructure $
.$ %
Handlers% -
.- .
Administrators. <
;< =
public 
class $
GetAdministratorsHandler %
(% &
StoredDbContext& 5
	DbContext6 ?
)? @
:A B
IRequestHandlerC R
<R S"
GetAdministratorsQueryS i
,i j
IEnumerablek v
<v w
AdministratorDto	w á
>
á à
>
à â
{		 
public

 

async

 
Task

 
<

 
IEnumerable

 !
<

! "
AdministratorDto

" 2
>

2 3
>

3 4
Handle

5 ;
(

; <"
GetAdministratorsQuery

< R
request

S Z
,

Z [
CancellationToken

\ m
cancellationToken

n 
)	

 Ä
{ 
return 
await 
	DbContext 
. 
Administrator ,
., -
AsNoTracking- 9
(9 :
): ;
. 
Select 
( 
i 
=> 
new 
AdministratorDto -
(- .
). /
{ 
Id 
= 
i 
. 
Id 
, 
AdministratorName !
=" #
i$ %
.% &
AdministratorName& 7
,7 8
AdministratorPhone "
=# $
i% &
.& '
AdministratorPhone' 9
} 
) 
. 
ToListAsync 
( 
cancellationToken *
)* +
;+ ,
} 
} €
ïC:\Users\CARLOS\Desktop\Aprendizaje\CSharp\Nurtricenter-Contracting\Contracting.Infrastructure\Handlers\Administrators\GetAdministratorByIdHandler.cs
	namespace 	
Contracting
 
. 
Infrastructure $
.$ %
Handlers% -
.- .
Administrators. <
;< =
public

 
class

 '
GetAdministratorByIdHandler

 (
(

( )
StoredDbContext

) 8
	DbContext

9 B
)

B C
:

D E
IRequestHandler

F U
<

U V%
GetAdministratorByIdQuery

V o
,

o p
Result

q w
<

w x
AdministratorDto	

x à
>


à â
>


â ä
{ 
public 

async 
Task 
< 
Result 
< 
AdministratorDto -
>- .
>. /
Handle0 6
(6 7%
GetAdministratorByIdQuery7 P
requestQ X
,X Y
CancellationTokenZ k
cancellationTokenl }
)} ~
{ 
var 
administrator 
= 
await !
	DbContext" +
.+ ,
Administrator, 9
.9 :
AsNoTracking: F
(F G
)G H
. 
Where 
( 
t 
=> 
t 
. 
Id 
== 
request  '
.' (
AdministratorId( 7
)7 8
. 
Select 
( 
t 
=> 
new 
AdministratorDto -
(- .
). /
{ 
Id 
= 
t 
. 
Id 
, 
AdministratorName !
=" #
t$ %
.% &
AdministratorName& 7
,7 8
AdministratorPhone "
=# $
t% &
.& '
AdministratorPhone' 9
} 
) 
. 
FirstOrDefaultAsync  
(  !
cancellationToken! 2
)2 3
;3 4
return 
administrator 
; 
} 
} ¨	
C:\Users\CARLOS\Desktop\Aprendizaje\CSharp\Nurtricenter-Contracting\Contracting.Infrastructure\Extensions\SecurityExtensions.cs
	namespace 	
Contracting
 
. 
Infrastructure $
.$ %

Extensions% /
;/ 0
public 
static 
class 
SecurityExtensions &
{		 
public

 
static

 
IServiceCollection

 !
AddSecurity

" -
(

- .
this

. 2
IServiceCollection

3 E
services

F N
,

N O
IHostEnvironment

P `
environment

a l
)

l m
{ 
if 
( 
environment 
is 
IWebHostEnvironment (
)( )
{ 
var 

jwtOptions 
= 
services 
.  
BuildServiceProvider 1
(1 2
)2 3
.3 4
GetRequiredService4 F
<F G

JwtOptionsG Q
>Q R
(R S
)S T
;T U
} 
return 
services	 
; 
} 
} ˚F
}C:\Users\CARLOS\Desktop\Aprendizaje\CSharp\Nurtricenter-Contracting\Contracting.Infrastructure\Extensions\SecretExtensions.cs
	namespace 	
Contracting
 
. 
Infrastructure $
.$ %

Extensions% /
;/ 0
public 
static 
class 
SecretExtensions $
{ 
private 
const	 
string  
JwtOptionsSecretName *
=+ ,
$str- 9
;9 :
private 
const	 
string &
RabbitMqSettingsSecretName 0
=1 2
$str3 E
;E F
private 
const	 
string 9
-ContractingDatabaseConnectionStringSecretName C
=D E
$strF k
;k l
private 
const	 
string $
JeagerSettingsSecretName .
=/ 0
$str1 A
;A B
public 
static 
IServiceCollection !

AddSecrets" ,
(, -
this- 1
IServiceCollection2 D
servicesE M
,M N
IConfigurationO ]
configuration^ k
,k l
IHostEnvironmentm }
environment	~ â
)
â ä
{ 
bool 
useSecretManager 
= 
configuration '
.' (
GetValue( 0
<0 1
bool1 5
>5 6
(6 7
$str7 I
,I J
falseK P
)P Q
;Q R
if 
( 
environment 
. 
IsDevelopment 
(  
)  !
&&" $
!% &
useSecretManager& 6
)6 7
{ 
configuration 
. 
LoadAndRegister 
< 
RabbitMqSettings %
>% &
(& '
services' /
,/ 0&
RabbitMqSettingsSecretName1 K
)K L
. 
LoadAndRegister 
< 
DatabaseSettings %
>% &
(& '
services' /
,/ 09
-ContractingDatabaseConnectionStringSecretName1 ^
)^ _
. 
LoadAndRegister 
< 

JwtOptions 
>  
(  !
services! )
,) * 
JwtOptionsSecretName+ ?
)? @
. 
LoadAndRegister 
< 
JeagerSettings #
># $
($ %
services% -
,- .$
JeagerSettingsSecretName/ G
)G H
;H I
return 	
services
 
; 
}   
string"" 
?"" 	
vaultUrl""
 
="" 
Environment""  
.""  !"
GetEnvironmentVariable""! 7
(""7 8
$str""8 C
)""C D
;""D E
string## 
?## 	

vaultToken##
 
=## 
Environment## "
.##" #"
GetEnvironmentVariable### 9
(##9 :
$str##: G
)##G H
;##H I
if%% 
(%% 
string%% 
.%% 
IsNullOrEmpty%% 
(%% 
vaultUrl%% #
)%%# $
||%%% '
string%%( .
.%%. /
IsNullOrEmpty%%/ <
(%%< =

vaultToken%%= G
)%%G H
)%%H I
{&& 
throw'' 
new''	 %
InvalidOperationException'' &
(''& '
$str''' `
)''` a
;''a b
}(( 
var** 
settings** 
=** 
new** 
VaultSettings** "
(**" #
)**# $
{++ 
VaultUrl,, 
=,, 
vaultUrl,, 
,,, 

VaultToken-- 
=-- 

vaultToken-- 
}.. 
;.. 
services00 

.00
 
AddHashicorpVault00 
(00 
settings00 %
)00% &
.11  
LoadSecretsFromVault11 
(11 
)11 
;11 
return33 
services33	 
;33 
}44 
public66 
static66 
void66  
LoadSecretsFromVault66 (
(66( )
this66) -
IServiceCollection66. @
services66A I
)66I J
{77 
using88 
var88 
serviceProvider88 
=88 
services88 &
.88& ' 
BuildServiceProvider88' ;
(88; <
)88< =
;88= >
var99 
scopeFactory99 
=99 
serviceProvider99 $
.99$ %
GetRequiredService99% 7
<997 8 
IServiceScopeFactory998 L
>99L M
(99M N
)99N O
;99O P
using;; 
var;; 
scope;; 
=;; 
scopeFactory;;  
.;;  !
CreateScope;;! ,
(;;, -
);;- .
;;;. /
var<< 
secretManager<< 
=<< 
scope<< 
.<< 
ServiceProvider<< +
.<<+ ,
GetRequiredService<<, >
<<<> ?
ISecretManager<<? M
><<M N
(<<N O
)<<O P
;<<P Q
string>> 
VaultMountPoint>>	 
=>> 
$str>> $
;>>$ %
Task@@ 
[@@ 
]@@ 
tasks@@	 
=@@ 
[@@ 
LoadAndRegisterAA 
<AA 

JwtOptionsAA 
>AA 
(AA  
secretManagerAA  -
,AA- .
servicesAA/ 7
,AA7 8 
JwtOptionsSecretNameAA9 M
,AAM N
VaultMountPointAAO ^
)AA^ _
,AA_ `
LoadAndRegisterBB 
<BB 
RabbitMqSettingsBB $
>BB$ %
(BB% &
secretManagerBB& 3
,BB3 4
servicesBB5 =
,BB= >&
RabbitMqSettingsSecretNameBB? Y
,BBY Z
VaultMountPointBB[ j
)BBj k
,BBk l
LoadAndRegisterCC 
<CC 
DatabaseSettingsCC $
>CC$ %
(CC% &
secretManagerCC& 3
,CC3 4
servicesCC5 =
,CC= >9
-ContractingDatabaseConnectionStringSecretNameCC? l
,CCl m
VaultMountPointCCn }
)CC} ~
,CC~ 
LoadAndRegisterDD 
<DD 
JeagerSettingsDD "
>DD" #
(DD# $
secretManagerDD$ 1
,DD1 2
servicesDD3 ;
,DD; <$
JeagerSettingsSecretNameDD= U
,DDU V
VaultMountPointDDW f
)DDf g
]EE 
;EE 
TaskGG 
.GG 
WaitAllGG 
(GG 
tasksGG 
)GG 
;GG 
}HH 
publicJJ 
staticJJ 
asyncJJ 
TaskJJ 
LoadAndRegisterJJ )
<JJ) *
TJJ* +
>JJ+ ,
(JJ, -
ISecretManagerJJ- ;
secretManagerJJ< I
,JJI J
IServiceCollectionJJK ]
servicesJJ^ f
,JJf g
stringKK 

secretNameKK	 
,KK 
stringKK 

mountPointKK &
)KK& '
whereKK( -
TKK. /
:KK0 1
classKK2 7
,KK7 8
newKK9 <
(KK< =
)KK= >
{LL 
TMM 
secretMM 

=MM 
awaitMM 
secretManagerMM  
.MM  !
GetMM! $
<MM$ %
TMM% &
>MM& '
(MM' (

secretNameMM( 2
,MM2 3

mountPointMM4 >
)MM> ?
;MM? @
servicesNN 

.NN
 
AddSingletonNN 
<NN 
TNN 
>NN 
(NN 
secretNN !
)NN! "
;NN" #
}OO 
publicQQ 
staticQQ 
IConfigurationQQ 
LoadAndRegisterQQ -
<QQ- .
TQQ. /
>QQ/ 0
(QQ0 1
thisQQ1 5
IConfigurationQQ6 D
configurationQQE R
,QQR S
IServiceCollectionQQT f
servicesQQg o
,QQo p
stringRR 

secretNameRR	 
)RR 
whereRR 
TRR 
:RR 
classRR $
,RR$ %
newRR& )
(RR) *
)RR* +
{SS 
TTT 
secretTT 

=TT 
	ActivatorTT 
.TT 
CreateInstanceTT %
<TT% &
TTT& '
>TT' (
(TT( )
)TT) *
;TT* +
configurationUU 
.UU 
BindUU 
(UU 

secretNameUU 
,UU  
secretUU! '
)UU' (
;UU( )
servicesVV 

.VV
 
AddSingletonVV 
<VV 
TVV 
>VV 
(VV 
secretVV !
)VV! "
;VV" #
returnWW 
configurationWW	 
;WW 
}XX 
}ZZ Ó
ÑC:\Users\CARLOS\Desktop\Aprendizaje\CSharp\Nurtricenter-Contracting\Contracting.Infrastructure\Extensions\ObservabilityExtensions.cs
	namespace

 	
Contracting


 
.

 
Infrastructure

 $
.

$ %

Extensions

% /
;

/ 0
public 
static 
class #
ObservabilityExtensions +
{ 
public 

static 
IServiceCollection $
AddObservability% 5
(5 6
this6 :
IServiceCollection; M
servicesN V
,V W
IHostEnvironment 
environment $
,$ %
string& ,
serviceName- 8
)8 9
{ 
var 
jaegerSettings 
= 
services %
.% & 
BuildServiceProvider& :
(: ;
); <
.< =
GetRequiredService= O
<O P
JeagerSettingsP ^
>^ _
(_ `
)` a
;a b
bool 
isWebApp 
= 
environment #
is$ &
IWebHostEnvironment' :
;: ;
services 
. 
AddObservability !
(! "
serviceName" -
,- .
jaegerSettings/ =
,= >
builder 
=> 
{ 
builder 
. 
	AddSource !
(! "
$str" 1
)1 2
. 
	AddSource 
( 
$str >
)> ?
. 
	AddNpgsql 
( 
)  
;  !
} 
, ,
 shouldIncludeHttpInstrumentation ,
:, -
isWebApp. 6
)6 7
;7 8
if 

(
 
isWebApp 
) 
{ 	
services 
. #
AddServicesHealthChecks ,
(, -
)- .
;. /
}   	
return!! 
services!! 
;!! 
}"" 
public$$ 

static$$ 
IServiceCollection$$ $#
AddServicesHealthChecks$$% <
($$< =
this$$= A
IServiceCollection$$B T
services$$U ]
)$$] ^
{%% 
var&& 
databaseSettings&& 
=&& 
services&& '
.&&' ( 
BuildServiceProvider&&( <
(&&< =
)&&= >
.&&> ?
GetRequiredService&&? Q
<&&Q R
DatabaseSettings&&R b
>&&b c
(&&c d
)&&d e
;&&e f
var'' 
connectionString'' 
='' 
databaseSettings'' /
.''/ 0
ConnectionString''0 @
;''@ A
services)) 
.** 
AddHealthChecks** 
(** 
)** 
.++ 
	AddNpgSql++ 
(++ 
connectionString++ '
)++' (
.,, "
AddRabbitMqHealthCheck,, #
(,,# $
),,$ %
;,,% &
return.. 
services.. 
;.. 
}// 
}00 ë
C:\Users\CARLOS\Desktop\Aprendizaje\CSharp\Nurtricenter-Contracting\Contracting.Infrastructure\Extensions\DatabaseExtensions.cs
	namespace 	
Contracting
 
. 
Infrastructure $
.$ %

Extensions% /
;/ 0
public 
static 
class 
DatabaseExtensions &
{ 
public 
static 
IServiceCollection !
AddDatabase" -
(- .
this. 2
IServiceCollection3 E
servicesF N
)N O
{ 
var 
databaseSettings 
= 
services !
.! " 
BuildServiceProvider" 6
(6 7
)7 8
.8 9
GetRequiredService9 K
<K L
DatabaseSettingsL \
>\ ]
(] ^
)^ _
;_ `
var 
connectionString 
= 
databaseSettings )
.) *
ConnectionString* :
;: ;
void 
optionsAction 
( #
DbContextOptionsBuilder ,
options- 4
)4 5
=>6 8
options9 @
.@ A
	UseNpgsqlA J
(J K
connectionStringK [
)[ \
;\ ]
services 

.
 
AddDbContext 
< 
StoredDbContext '
>' (
(( )
optionsAction) 6
)6 7
.7 8
AddDbContext8 D
<D E
DomainDbContextE T
>T U
(U V
optionsActionV c
)c d
;d e
services 

.
 
	AddScoped 
< 
IUnitOfWork  
,  !

UnitOfWork" ,
>, -
(- .
). /
. 
	AddScoped 
< 
	IDatabase 
, 
StoredDbContext )
>) *
(* +
)+ ,
. 
	AddScoped 
< 
IPatientRepository !
,! "
PatientRepository# 4
>4 5
(5 6
)6 7
. 
	AddScoped 
< $
IAdministratorRepository '
,' (#
AdministratorRepository) @
>@ A
(A B
)B C
.   
	AddScoped   
<   
IContractRepository   "
,  " #
ContractRepository  $ 6
>  6 7
(  7 8
)  8 9
.!! 
	AddScoped!! 
<!! 
IOutboxDatabase!! 
<!! 
DomainEvent!! *
>!!* +
,!!+ ,

UnitOfWork!!- 7
>!!7 8
(!!8 9
)!!9 :
."" 
	AddOutbox"" 
<"" 
DomainEvent"" 
>"" 
("" 
)"" 
;"" 
services$$ 

.$$
 
Decorate$$ 
<$$ 
IOutboxService$$ "
<$$" #
DomainEvent$$# .
>$$. /
,$$/ 0 
OutboxTracingService$$1 E
<$$E F
DomainEvent$$F Q
>$$Q R
>$$R S
($$S T
)$$T U
;$$U V
return&& 
services&&	 
;&& 
}'' 
}(( ›	
}C:\Users\CARLOS\Desktop\Aprendizaje\CSharp\Nurtricenter-Contracting\Contracting.Infrastructure\Extensions\BrokerExtensions.cs
	namespace 	
Contracting
 
. 
Infrastructure $
.$ %

Extensions% /
;/ 0
public 
static 
class 
BrokerExtensions $
{ 
public		 
static		 
IServiceCollection		 !
AddRabbitMQ		" -
(		- .
this		. 2
IServiceCollection		3 E
services		F N
)		N O
{

 
using 
var 
serviceProvider 
= 
services &
.& ' 
BuildServiceProvider' ;
(; <
)< =
;= >
var 
rabbitMqSettings 
= 
serviceProvider (
.( )
GetRequiredService) ;
<; <
RabbitMqSettings< L
>L M
(M N
)N O
;O P
services 

.
 
AddRabbitMQ 
( 
rabbitMqSettings '
)' (
;( )
return 
services	 
; 
} 
} Ã
uC:\Users\CARLOS\Desktop\Aprendizaje\CSharp\Nurtricenter-Contracting\Contracting.Infrastructure\DependencyInjection.cs
	namespace 	
Contracting
 
. 
Infrastructure $
;$ %
public		 
static		 
class		 
DependencyInjection		 '
{

 
public 

static 
IServiceCollection $
AddInfrastructure% 6
(6 7
this7 ;
IServiceCollection< N
servicesO W
,W X
IConfigurationY g
configurationh u
,u v
IHostEnvironment	w á
environment
à ì
,
ì î
string
ï õ
serviceName
ú ß
)
ß ®
{ 
services 

.
 

AddMediatR 
( 
config 
=> 
config  &
.& '(
RegisterServicesFromAssembly' C
(C D
AssemblyD L
.L M 
GetExecutingAssemblyM a
(a b
)b c
)c d
)d e
;e f
services 

.
 

AddSecrets 
( 
configuration #
,# $
environment% 0
)0 1
. 
AddObservability 
( 
environment  
,  !
serviceName" -
)- .
. 
AddDatabase 
( 
) 
. 
AddSecurity 
( 
environment 
) 
. 
AddRabbitMQ 
( 
) 
; 
return 
services	 
; 
} 
} 